name: Rotate Cron Times

on:
  schedule:
    - cron: '0 0 1 * *'  # Her ayÄ±n 1'inde gece 00:00'da
  workflow_dispatch:

permissions:
  contents: write

jobs:
  rotate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Update cron times in log-my-progress.yml
        run: |
          FILE=".github/workflows/log-my-progress.yml"
          NEW_CRONS=$(for i in {1..5}; do echo "    - cron: '$(shuf -i 0-59 -n 1) $(shuf -i 6-23 -n 1) * * *'"; done)
          awk -v new_crons="$NEW_CRONS" '
            BEGIN {inside=0}
            /^  schedule:/ {print; inside=1; next}
            inside && /^  workflow_dispatch:/ {inside=0; print new_crons; print; next}
            !inside {print}
          ' "$FILE" > tmp.yml && mv tmp.yml "$FILE"

      - name: Commit
        run: |
          git config user.name "ErkanBarann"
          git config user.email "115561897+ErkanBarann@users.noreply.github.com"
          git add .github/workflows/log-my-progress.yml
          git commit -m "ğŸ” Update daily cron times"
          git push
